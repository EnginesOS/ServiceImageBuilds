upstream app {
    # Path to Puma SOCK file, as defined previously
    server unix:/var/run/puma.sock fail_timeout=0;
}
 
 server {
        listen 8001;
    server_name mgmt.current.engines.org;
    add_header Accept-Ranges bytes;
   
   #  add_header Strict-Transport-Security "max-age=31536000; includeSubdomains";
    proxy_read_timeout 300s;
   ssl on;
    ssl_session_cache    shared:SSL:1m;
    ssl_session_timeout  10m;
    ssl_certificate /opt/engines/etc/ssl/certs/engines.crt;
    ssl_certificate_key /opt/engines/etc/ssl/keys/engines.key;

    ssl_verify_client off;
    ssl_protocols        SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
             
#    include /home/app/.env_vars;
#    include /home/app/.ruby_env;
 root /home/app/public/;
location @app {
        proxy_set_header X-Forwarded-Proto https;
        proxy_pass http://app;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
    }

  location ^~ /assets/ {
    gzip_static on;
    expires max;
    add_header Cache-Control public;
}

 try_files $uri/index.html $uri @app;

        access_log /var/log/access.log;
        error_log /var/log/error.log;
    }